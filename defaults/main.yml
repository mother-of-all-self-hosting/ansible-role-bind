# SPDX-FileCopyrightText: 2023 - 2024 Nikita Chernyi
# SPDX-FileCopyrightText: 2023 - 2025 Slavi Pantaleev
# SPDX-FileCopyrightText: 2024 Sergio Durigan Junior
# SPDX-FileCopyrightText: 2025 MASH project contributors
# SPDX-FileCopyrightText: 2025 Suguru Hirahara
#
# SPDX-License-Identifier: AGPL-3.0-or-later

---
# Project source code URL: https://gitlab.isc.org/isc-projects/bind9

bind_enabled: true

# Controls whether IPv6 connectivity is enabled.
# When disabled, BIND will not use IPv6 for outgoing connections (queries, transfers, notifications).
# This setting affects:
# - IPv6 listen-on directives (auto-disables all v6 listeners)
# - IPv6 query source addresses (sets to "none")
# Note: This does NOT affect whether BIND resolves AAAA records or serves them.
# It only controls whether BIND itself attempts to use IPv6 for certain network connectivity tasks.
bind_ipv6_connectivity_enabled: true

bind_identifier: bind
bind_base_path: "/{{ bind_identifier }}"

# Directory paths for BIND
bind_config_path: "{{ bind_base_path }}/config"
bind_cache_path: "{{ bind_base_path }}/cache"
bind_data_path: "{{ bind_base_path }}/data"
bind_bin_path: "{{ bind_base_path }}/bin"

########################################################################
#                                                                      #
# Configuration                                                        #
#                                                                      #
########################################################################

# -------------------------------------------------------------------- #
# ACL                                                                  #
# -------------------------------------------------------------------- #

# Controls the ACL definitions.
# Dictionary where keys are ACL names and values are lists of network addresses/ranges.
# Example:
# bind_config_acl_custom:
#   trusted:
#     - 1.2.3.4/24
#     - 1.2.5.12/32
bind_config_acl: "{{ bind_config_acl_default | combine(bind_config_acl_auto) | combine(bind_config_acl_custom) }}"
bind_config_acl_default: {}
bind_config_acl_auto: {}
bind_config_acl_custom: {}

# -------------------------------------------------------------------- #
# /ACL                                                                 #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Controls                                                             #
# -------------------------------------------------------------------- #

# Controls the control channel definitions (inet entries).
# Each entry is a dictionary with 'address', 'port', 'allow', 'keys', and optional 'read_only' properties.
# Example:
# bind_config_controls_inet_custom:
#   - address: "127.0.0.1"
#     port: 953
#     allow: ["localhost"]
#     keys: ["rndc-key"]
#     read_only: false
bind_config_controls_inet: '{{ bind_config_controls_inet_default + bind_config_controls_inet_auto + bind_config_controls_inet_custom }}'
bind_config_controls_inet_default: |-
  {{
    (
      [{
        "address": ("127.0.0.1" if bind_container_network == 'host' else '*'),
        "port": bind_container_rndc_port,
        "allow": ["localhost"],
        "keys": [bind_config_key_default_rndc_name]
      }]
      if bind_config_key_default_rndc_enabled
      else []
    )
  }}
bind_config_controls_inet_auto: []
bind_config_controls_inet_custom: []

# -------------------------------------------------------------------- #
# /Controls                                                            #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Key                                                                  #
# -------------------------------------------------------------------- #

# Controls whether the default RNDC key is defined.
bind_config_key_default_rndc_enabled: false

# The name of the RNDC key.
bind_config_key_default_rndc_name: rndc

# The algorithm to use for the RNDC key.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-algorithm
bind_config_key_default_rndc_algorithm: hmac-sha512

# The raw secret (before base64 encoding) for the RNDC key.
# This will be base64-encoded automatically.
# Required when bind_config_key_default_rndc_enabled is true.
bind_config_key_default_rndc_secret_raw: ''

# The base64-encoded secret for the RNDC key (computed from the raw secret).
bind_config_key_default_rndc_secret: "{{ bind_config_key_default_rndc_secret_raw | b64encode if bind_config_key_default_rndc_secret_raw else '' }}"

# Controls the key definitions.
# Dictionary where keys are key names and values are key configuration dictionaries.
# Each key configuration should have 'algorithm' and 'secret' properties.
# Example:
# bind_config_key_custom:
#   mykey:
#     algorithm: hmac-sha256
#     secret: "base64encodedstring=="
bind_config_key: "{{ bind_config_key_default | combine(bind_config_key_auto) | combine(bind_config_key_custom) }}"
bind_config_key_default: "{{ {bind_config_key_default_rndc_name: {'algorithm': bind_config_key_default_rndc_algorithm, 'secret': bind_config_key_default_rndc_secret}} if bind_config_key_default_rndc_enabled else {} }}"
bind_config_key_auto: {}
bind_config_key_custom: {}

# -------------------------------------------------------------------- #
# /Key                                                                 #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Logging                                                              #
# -------------------------------------------------------------------- #

# Controls whether the `logging` block appears in the configuration.
#
# If disabled, BIND uses its default logging configuration.
#
# We disable this by default, because logging configuration is ignored when `named` is started with a `-g` flag
# and BIND logs directly to the console.
# We start it with the `-g` flag by default (see `bind_container_process_arguments_default`).
bind_config_logging_enabled: false

# Controls the `logging.category` configuration properties.
bind_config_logging_categories: "{{ bind_config_logging_categories_default | combine(bind_config_logging_categories_auto) | combine(bind_config_logging_categories_custom) }}"
bind_config_logging_categories_default:
  default: "{{ bind_config_logging_categories_default_default_list }}"
  unmatched: "{{ bind_config_logging_categories_default_unmatched_list }}"
bind_config_logging_categories_default_default_list: ["default_stderr"]
bind_config_logging_categories_default_unmatched_list: ["null"]
bind_config_logging_categories_auto: {}
bind_config_logging_categories_custom: {}

# Controls the `logging.channel` configuration properties.
# Dictionary where keys are channel names and values are channel configuration dictionaries.
# Example:
# bind_config_logging_channels_custom:
#   my_file:
#     file: "/var/log/bind.log"
#     severity: info
#     print-time: "yes"
bind_config_logging_channels: "{{ bind_config_logging_channels_default | combine(bind_config_logging_channels_auto) | combine(bind_config_logging_channels_custom) }}"
bind_config_logging_channels_default: {}
bind_config_logging_channels_auto: {}
bind_config_logging_channels_custom: {}

# -------------------------------------------------------------------- #
# /Logging                                                             #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Options                                                              #
# -------------------------------------------------------------------- #

# Controls the `options.directory` configuration property
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-directory
bind_config_options_directory: "/var/cache/bind"

# -------------------------------------------------------------------- #
# Options (DNS listener)                                               #
# -------------------------------------------------------------------- #

# Controls whether the `options.listen-on` directive for DNS is configured.
bind_config_options_dns_listen_on_enabled: true

# Controls the `options.listen-on` configuration property for DNS (main entry only)
# Additional listen-on entries can be added via `bind_config_options_additional_configuration`.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-listen-on
bind_config_options_dns_listen_on_port: "{{ bind_container_dns_port }}"
bind_config_options_dns_listen_on_addresses: ["any"]
# Additional stanzas to append to the main DNS listen-on entry (e.g., "tls none")
# Example: bind_config_options_dns_listen_on_additional_stanzas: "tls none"
bind_config_options_dns_listen_on_additional_stanzas: ''

# Controls whether the `options.listen-on-v6` directive for DNS is configured.
bind_config_options_dns_listen_on_v6_enabled: "{{ bind_config_options_dns_listen_on_enabled and bind_ipv6_connectivity_enabled }}"

# Controls the `options.listen-on-v6` configuration property for DNS (main entry only)
# Additional listen-on-v6 entries can be added via `bind_config_options_additional_configuration`.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-listen-on-v6
bind_config_options_dns_listen_on_v6_port: "{{ bind_container_dns_port }}"
bind_config_options_dns_listen_on_v6_addresses: ["any"]
# Additional stanzas to append to the main DNS listen-on-v6 entry (e.g., "tls none")
# Defaults to the same value as the IPv4 DNS listener.
# Example: bind_config_options_dns_listen_on_v6_additional_stanzas: "tls none"
bind_config_options_dns_listen_on_v6_additional_stanzas: "{{ bind_config_options_dns_listen_on_additional_stanzas }}"

# -------------------------------------------------------------------- #
# /Options (DNS listener)                                              #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Options (DoT listener)                                               #
# -------------------------------------------------------------------- #

# Controls whether an additional `options.listen-on` directive for DNS-over-TLS (DoT) is configured.
# DoT provides encrypted DNS queries over TLS on port 853.
# Ref: https://bind9.readthedocs.io/en/stable/chapter8.html#dns-over-tls-dot
bind_config_options_dot_listen_on_enabled: false

# Controls the DoT listen-on port.
bind_config_options_dot_listen_on_port: "{{ bind_container_dot_port }}"
bind_config_options_dot_listen_on_addresses: ["any"]
# The TLS certificate profile name to use for DoT.
# This refers to a tls block defined in your BIND configuration.
# Required when bind_config_options_dot_listen_on_enabled is true.
# Example: bind_config_options_dot_listen_on_tls_name: "myserver"
bind_config_options_dot_listen_on_tls_name: ''
# Additional stanzas to append to the DoT listen-on entry (beyond the TLS stanza).
# Example: bind_config_options_dot_listen_on_additional_stanzas: "some-option"
bind_config_options_dot_listen_on_additional_stanzas: ''

# Controls whether an additional `options.listen-on-v6` directive for DoT is configured.
# Automatically enabled when the IPv4 DoT listener is enabled and IPv6 connectivity is enabled.
bind_config_options_dot_listen_on_v6_enabled: "{{ bind_config_options_dot_listen_on_enabled and bind_ipv6_connectivity_enabled }}"

# Controls the DoT listen-on-v6 port.
bind_config_options_dot_listen_on_v6_port: "{{ bind_container_dot_port }}"
bind_config_options_dot_listen_on_v6_addresses: ["any"]
# The TLS certificate profile name for DoT over IPv6.
# Defaults to the same value as the IPv4 DoT listener.
bind_config_options_dot_listen_on_v6_tls_name: "{{ bind_config_options_dot_listen_on_tls_name }}"
# Additional stanzas for DoT over IPv6.
# Defaults to the same value as the IPv4 DoT listener.
bind_config_options_dot_listen_on_v6_additional_stanzas: "{{ bind_config_options_dot_listen_on_additional_stanzas }}"

# -------------------------------------------------------------------- #
# /Options (DoT listener)                                              #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Options (DoH listener)                                               #
# -------------------------------------------------------------------- #

# Controls whether an additional `options.listen-on` directive for DNS-over-HTTPS (DoH) over TLS is configured.
# DoH provides encrypted DNS queries over HTTPS on port 443.
# Ref: https://bind9.readthedocs.io/en/stable/chapter8.html#dns-over-https-doh
bind_config_options_doh_listen_on_enabled: false

# Controls the DoH listen-on port.
bind_config_options_doh_listen_on_port: "{{ bind_container_doh_port }}"
bind_config_options_doh_listen_on_addresses: ["any"]
# The TLS certificate profile name to use for DoH.
# This refers to a tls block defined in your BIND configuration.
# Required when bind_config_options_doh_listen_on_enabled is true.
# Example: bind_config_options_doh_listen_on_tls_name: "myserver"
bind_config_options_doh_listen_on_tls_name: ''
# The HTTP endpoint profile name to use for DoH.
# This refers to an http block defined in your BIND configuration.
# Example: bind_config_options_doh_listen_on_http_endpoint: "custom_doh"
bind_config_options_doh_listen_on_http_endpoint: "default"
# Additional stanzas to append to the DoH listen-on entry (beyond the TLS and HTTP stanzas).
# Example: bind_config_options_doh_listen_on_additional_stanzas: "some-option"
bind_config_options_doh_listen_on_additional_stanzas: ''

# Controls whether an additional `options.listen-on-v6` directive for DoH is configured.
# Automatically enabled when the IPv4 DoH listener is enabled and IPv6 connectivity is enabled.
bind_config_options_doh_listen_on_v6_enabled: "{{ bind_config_options_doh_listen_on_enabled and bind_ipv6_connectivity_enabled }}"

# Controls the DoH listen-on-v6 port.
bind_config_options_doh_listen_on_v6_port: "{{ bind_container_doh_port }}"
bind_config_options_doh_listen_on_v6_addresses: ["any"]
# The TLS certificate profile name for DoH over IPv6.
# Defaults to the same value as the IPv4 DoH listener.
bind_config_options_doh_listen_on_v6_tls_name: "{{ bind_config_options_doh_listen_on_tls_name }}"
# The HTTP endpoint profile name for DoH over IPv6.
# Defaults to the same value as the IPv4 DoH listener.
bind_config_options_doh_listen_on_v6_http_endpoint: "{{ bind_config_options_doh_listen_on_http_endpoint }}"
# Additional stanzas for DoH over IPv6.
# Defaults to the same value as the IPv4 DoH listener.
bind_config_options_doh_listen_on_v6_additional_stanzas: "{{ bind_config_options_doh_listen_on_additional_stanzas }}"

# -------------------------------------------------------------------- #
# /Options (DoH listener)                                              #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Options (HTTP listener)                                              #
# -------------------------------------------------------------------- #

# Controls whether an additional `options.listen-on` directive for HTTP is configured.
# This creates a separate listen-on entry for DNS-over-HTTPS (DoH) over unencrypted HTTP.
# Typically used when BIND sits behind a reverse proxy that handles TLS termination.
# Ref: https://bind9.readthedocs.io/en/stable/chapter8.html#dns-over-https-doh
bind_config_options_http_listen_on_enabled: false

# Controls the HTTP listen-on port.
bind_config_options_http_listen_on_port: "{{ bind_container_http_port }}"
bind_config_options_http_listen_on_addresses: ["any"]
# The TLS setting for HTTP (insecure DoH).
# Set to "none" for unencrypted HTTP, typically when behind a reverse proxy.
# Do not change this unless you know what you're doing.
bind_config_options_http_listen_on_tls_name: "none"
# The HTTP endpoint profile name to use for insecure DoH.
# This refers to an http block defined in your BIND configuration.
# Example: bind_config_options_http_listen_on_http_endpoint: "custom_doh"
bind_config_options_http_listen_on_http_endpoint: "default"
# Additional stanzas to append to the HTTP listen-on entry (beyond the TLS and HTTP stanzas).
# Example: bind_config_options_http_listen_on_additional_stanzas: "some-option"
bind_config_options_http_listen_on_additional_stanzas: ''

# Controls whether an additional `options.listen-on-v6` directive for HTTP is configured.
# Automatically enabled when the IPv4 HTTP listener is enabled and IPv6 connectivity is enabled.
bind_config_options_http_listen_on_v6_enabled: "{{ bind_config_options_http_listen_on_enabled and bind_ipv6_connectivity_enabled }}"

# Controls the HTTP listen-on-v6 port.
bind_config_options_http_listen_on_v6_port: "{{ bind_container_http_port }}"
bind_config_options_http_listen_on_v6_addresses: ["any"]
# The TLS setting for HTTP over IPv6.
# Defaults to the same value as the IPv4 HTTP listener.
bind_config_options_http_listen_on_v6_tls_name: "{{ bind_config_options_http_listen_on_tls_name }}"
# The HTTP endpoint profile name for HTTP over IPv6.
# Defaults to the same value as the IPv4 HTTP listener.
bind_config_options_http_listen_on_v6_http_endpoint: "{{ bind_config_options_http_listen_on_http_endpoint }}"
# Additional stanzas for HTTP over IPv6.
# Defaults to the same value as the IPv4 HTTP listener.
bind_config_options_http_listen_on_v6_additional_stanzas: "{{ bind_config_options_http_listen_on_additional_stanzas }}"

# -------------------------------------------------------------------- #
# /Options (HTTP listener)                                             #
# -------------------------------------------------------------------- #

# Controls the `options.allow-query` configuration property
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-allow-query
bind_config_options_allow_query: ["any"]

# Controls the `options.recursion` configuration property
# See `bind_config_options_allow_recursion` for controlling which clients can use recursion.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-recursion
bind_config_options_recursion: true

# Controls the `options.recursive-clients` configuration property
# When empty, this setting is omitted from the configuration and the upstream default is used.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-recursive-clients
bind_config_options_recursive_clients: ~

# Controls the `options.tcp-clients` configuration property
# When empty, this setting is omitted from the configuration and the upstream default is used.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-tcp-clients
bind_config_options_tcp_clients: ~

# Controls the `options.allow-recursion` configuration property
# Only applies if `bind_config_options_recursion` is enabled.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-allow-recursion
bind_config_options_allow_recursion: ["none"]

# Controls the `options.allow-transfer` configuration property
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-allow-transfer
bind_config_options_allow_transfer: ["none"]

# Controls the `options.allow-update` configuration property
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-allow-update
bind_config_options_allow_update: ["none"]

# Controls the `options.dnssec-validation` configuration property
# When empty, this setting is omitted from the configuration and the upstream default is used.
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-dnssec-validation
bind_config_options_dnssec_validation: ~

# Controls the `options.notify-source` configuration property (IPv4 source address for NOTIFY messages)
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-notify-source
bind_config_options_notify_source: []

# Controls the `options.notify-source-v6` configuration property (IPv6 source address for NOTIFY messages)
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-notify-source-v6
bind_config_options_notify_source_v6: []

# Controls the `options.transfer-source` configuration property (IPv4 source address for zone transfers)
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-transfer-source
bind_config_options_transfer_source: []

# Controls the `options.transfer-source-v6` configuration property (IPv6 source address for zone transfers)
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-transfer-source-v6
bind_config_options_transfer_source_v6: []

# Controls the `options.query-source` configuration property (IPv4 source address for outgoing queries)
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-query-source
bind_config_options_query_source: []

# Controls the `options.query-source-v6` configuration property (IPv6 source address for outgoing queries)
# Ref: https://bind9.readthedocs.io/en/stable/reference.html#namedconf-statement-query-source-v6
bind_config_options_query_source_v6: "{{ [] if bind_ipv6_connectivity_enabled else ['none'] }}"

# Additional configuration to inject into the options block.
# This is in the form of a string that gets injected as-is.
# Example:
# bind_config_options_additional_configuration: |
#   recursion no;
#   dnssec-validation auto;
bind_config_options_additional_configuration: ''

# -------------------------------------------------------------------- #
# /Options                                                             #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Zones                                                                #
# -------------------------------------------------------------------- #

# Controls the zone definitions.
# Dictionary where keys are zone names and values are zone configuration dictionaries.
# Each zone configuration should have at minimum a 'type' property.
# Commonly used properties: type, file, class, primaries, also-notify, masterfile-format
# Example:
# bind_config_zones_custom:
#   "example.com":
#     type: primary
#     file: "/var/lib/bind/example.com.zone"
#   "sub.example.com":
#     type: secondary
#     file: "secondaries/sub.example.com"
#     primaries:
#       - 192.0.2.1
#       - 192.0.2.2
#     masterfile-format: text
#   ".":
#     class: IN
#     type: hint
#     file: "named.ca"
#     _additional_configuration: |
#       // Custom hint zone config
bind_config_zones: "{{ bind_config_zones_default | combine(bind_config_zones_auto) | combine(bind_config_zones_custom) }}"
bind_config_zones_default: {}
bind_config_zones_auto: {}
bind_config_zones_custom: {}

# Additional zone configuration to inject into named-zone.conf.
# This is in the form of a string that gets injected as-is.
# Use this for zones that don't fit the structured format above.
# Example:
# bind_config_zones_additional_configuration: |
#   zone "example.com" {
#       type primary;
#       file "/var/lib/bind/example.com.zone";
#   };
bind_config_zones_additional_configuration: ''

# -------------------------------------------------------------------- #
# /Zones                                                               #
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# Additional                                                           #
# -------------------------------------------------------------------- #

# Additional top-level configuration to inject into named.conf (outside of specific blocks).
# This is in the form of a string that gets injected as-is.
# Example:
# bind_config_additional_configuration: |
#   include "/etc/bind/rndc.key";
bind_config_additional_configuration: ''

# -------------------------------------------------------------------- #
# /Additional                                                          #
# -------------------------------------------------------------------- #

########################################################################
#                                                                      #
# /Configuration                                                       #
#                                                                      #
########################################################################

# Odd-numbered versions are development versions. We stick to stable.
# Ref: https://kb.isc.org/docs/aa-01540
# renovate: datasource=docker depName=bind packageName=docker.io/internetsystemsconsortium/bind9 versioning=semver
bind_version: "9.20"

# These match the `bind` user and group in the container.
bind_uid: 53
bind_gid: 53

# The port that the container process will use for DNS.
# This in-container port number can be changed to a higher-number port if permissions are an issue.
bind_container_dns_port: 53

# The port that the container process will use for RNDC.
# This in-container port number can be changed to a higher-number port if permissions are an issue.
bind_container_rndc_port: 953

# The port that the container process will use for DNS-over-TLS (DoT).
# This in-container port number can be changed if needed.
# Note: No DoT listeners are configured by default.
# To enable DoT, see `bind_config_options_dot_listen_on_enabled` and related variables.
bind_container_dot_port: 853

# The port that the container process will use for DNS-over-HTTPS (DoH) over TLS.
# This in-container port number can be changed if needed.
# Note: No DoH listeners are configured by default.
# To enable DoH, see `bind_config_options_doh_listen_on_enabled` and related variables.
bind_container_doh_port: 443

# The port that the container process will use for HTTP.
# This in-container port number can be changed if needed.
# This is typically used for DNS-over-HTTPS (DoH) over unencrypted HTTP connections,
# for example when behind a reverse proxy that handles TLS termination.
# Note: No HTTP listeners are configured by default. See `bind_config_options_http_listen_on_enabled`.
bind_container_http_port: 80

bind_container_image: "{{ bind_container_image_registry_prefix }}internetsystemsconsortium/bind9:{{ bind_container_image_tag }}"
bind_container_image_tag: "{{ bind_version }}"
bind_container_image_registry_prefix: "{{ bind_container_image_registry_prefix_upstream }}"
bind_container_image_registry_prefix_upstream: "{{ bind_container_image_registry_prefix_upstream_default }}"
bind_container_image_registry_prefix_upstream_default: docker.io/
bind_container_image_force_pull: "{{ bind_container_image.endswith(':latest') }}"

# Specifies how the container publishes its DNS UDP port (see `bind_config_options_listen_on_port`), if needed.
#
# Takes an "<ip>:<port>" value (e.g. "127.0.0.1:53"), just a port number or an empty string to not expose.
# Empty by default. Users should configure this manually if needed.
bind_container_dns_udp_bind_port: ''

# Specifies how the container publishes its DNS TCP port (see `bind_config_options_listen_on_port`), if needed.
#
# Takes an "<ip>:<port>" value (e.g. "127.0.0.1:53"), just a port number or an empty string to not expose.
# Empty by default. Users should configure this manually if needed.
bind_container_dns_tcp_bind_port: ''

# Specifies how the container publishes its RNDC control port (see `bind_container_rndc_port`), if needed.
#
# Takes an "<ip>:<port>" value (e.g. "127.0.0.1:953"), just a port number or an empty string to not expose.
# This is the remote name daemon control interface.
# For security reasons, it's recommended to only
# expose this over loopback (127.0.0.1) or not expose it at all.
# Empty by default. Use `bin/rndc` which invokes `rndc` inside the container for you.
bind_container_rndc_bind_port: ''

# Specifies how the container publishes its DNS-over-TLS (DoT) TCP port (see `bind_container_dot_port`), if needed.
#
# Takes an "<ip>:<port>" value (e.g. "0.0.0.0:853"), just a port number or an empty string to not expose.
# Empty by default. Users should configure this manually if needed.
# Note: You also need to configure DoT listeners in BIND configuration.
bind_container_dot_tcp_bind_port: ''

# Specifies how the container publishes its DNS-over-HTTPS (DoH) TCP port (see `bind_container_doh_port`), if needed.
#
# Takes an "<ip>:<port>" value (e.g. "0.0.0.0:443"), just a port number or an empty string to not expose.
# Empty by default. Users should configure this manually if needed.
# Note: You also need to configure DoH listeners and HTTP endpoints in BIND configuration.
bind_container_doh_tcp_bind_port: ''

# Specifies how the container publishes its HTTP TCP port (see `bind_container_http_port`), if needed.
#
# Takes an "<ip>:<port>" value (e.g. "127.0.0.1:8080"), just a port number or an empty string to not expose.
# Empty by default. Users should configure this manually if needed.
# This is typically used for DNS-over-HTTPS (DoH) over unencrypted HTTP, often behind a reverse proxy.
# Note: You also need to enable HTTP listeners via `bind_config_options_http_listen_on_enabled`.
bind_container_http_tcp_bind_port: ''

# The base container network. It will be auto-created by this role if it doesn't exist already.
bind_container_network: "{{ bind_identifier }}"

# Control if the container network is deleted on uninstalling.
bind_container_network_deletion_enabled: true

# A list of additional container networks that the container would be connected to.
# The role does not create these networks, so make sure they already exist.
# Use this to expose this container to another reverse proxy, which runs in a different container network.
bind_container_additional_networks: "{{ bind_container_additional_networks_auto + bind_container_additional_networks_custom }}"
bind_container_additional_networks_auto: []
bind_container_additional_networks_custom: []

# A list of additional "volumes" to mount in the container.
# This list gets populated dynamically at runtime. You can provide a different default value,
# if you wish to mount your own files into the container.
# Contains definition objects like this: `{"type": "bind", "src": "/outside", "dst": "/inside", "options": "readonly"}.
# See the `--mount` documentation for the `docker run` command.
#
# Example:
# bind_container_additional_volumes:
#   - type: bind
#     src: /path/on/the/host
#     dst: /data
#   - type: bind
#     src: /another-path/on/the/host
#     dst: /read-only
#     options: readonly
bind_container_additional_volumes: "{{ bind_container_additional_volumes_auto + bind_container_additional_volumes_custom }}"
bind_container_additional_volumes_auto: []
bind_container_additional_volumes_custom: []

# A list of extra arguments to pass to the container
bind_container_extra_arguments: "{{ bind_container_extra_arguments_auto + bind_container_extra_arguments_custom }}"
bind_container_extra_arguments_auto: []
bind_container_extra_arguments_custom: []

# A list of extra arguments to pass to the BIND process
bind_container_process_arguments: "{{ bind_container_process_arguments_default + bind_container_process_arguments_auto + bind_container_process_arguments_custom }}"
bind_container_process_arguments_default:
  - "-c /etc/bind/named.conf"
  - "-g"
bind_container_process_arguments_auto: []
bind_container_process_arguments_custom: []

# List of systemd services that BIND systemd service depends on
bind_systemd_required_services_list: "{{ bind_systemd_required_services_list_default + bind_systemd_required_services_list_auto + bind_systemd_required_services_list_custom }}"
bind_systemd_required_services_list_default: "{{ [devture_systemd_docker_base_docker_service_name] if devture_systemd_docker_base_docker_service_name else [] }}"
bind_systemd_required_services_list_auto: []
bind_systemd_required_services_list_custom: []

# List of systemd services that BIND systemd service wants
bind_systemd_wanted_services_list: "{{ bind_systemd_wanted_services_list_default + bind_systemd_wanted_services_list_auto + bind_systemd_wanted_services_list_custom }}"
bind_systemd_wanted_services_list_default: []
bind_systemd_wanted_services_list_auto: []
bind_systemd_wanted_services_list_custom: []

# Controls how long to wait for the container to stop gracefully before killing it.
bind_container_stop_grace_time_seconds: "{{ devture_systemd_docker_base_container_stop_grace_time_seconds }}"

# Controls how long the pre-start cleanup should wait for stale container-name release
# before failing startup explicitly.
bind_container_cleanup_timeout_seconds: "{{ devture_systemd_docker_base_container_cleanup_timeout_seconds }}"

# Controls the delay between pre-start cleanup retries.
bind_container_cleanup_retry_delay_seconds: "{{ devture_systemd_docker_base_container_cleanup_retry_delay_seconds }}"

# Shell command used in the systemd pre-start phase to deterministically remove a stale
# container and wait until Docker releases its name.
bind_container_cleanup_command: |
  i=0;
  while [ "$i" -lt {{ bind_container_cleanup_timeout_seconds }} ]; do
  {{ devture_systemd_docker_base_host_command_docker }} stop -t {{ bind_container_stop_grace_time_seconds }} {{ bind_identifier }} >/dev/null 2>&1 || true;
  {{ devture_systemd_docker_base_host_command_docker }} rm -f {{ bind_identifier }} >/dev/null 2>&1 || true;
  if {{ devture_systemd_docker_base_host_command_docker }} container inspect {{ bind_identifier }} >/dev/null 2>&1; then
  i=$((i + 1));
  sleep {{ bind_container_cleanup_retry_delay_seconds }};
  continue;
  fi;
  if {{ devture_systemd_docker_base_host_command_docker }} info >/dev/null 2>&1; then
  exit 0;
  fi;
  echo "Failed to query Docker daemon while cleaning up {{ bind_identifier }}" >&2;
  exit 1;
  done;
  echo "Failed to remove stale container {{ bind_identifier }} after {{ bind_container_cleanup_timeout_seconds }} attempts" >&2;
  exit 1

# Additional environment variables.
bind_environment_variables_additional_variables: ''
